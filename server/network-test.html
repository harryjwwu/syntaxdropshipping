<!DOCTYPE html>
<html>
<head>
    <title>ç½‘ç»œè¿æ¥æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>ç½‘ç»œè¿æ¥æµ‹è¯•</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(message) {
            results.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        async function testNetwork() {
            try {
                log('ğŸ” å¼€å§‹ç½‘ç»œæµ‹è¯•...');
                
                // 1. æµ‹è¯•åŸºç¡€è¿æ¥
                log('1. æµ‹è¯•åŸºç¡€HTTPè¿æ¥...');
                const healthResponse = await fetch('http://localhost:5001/api/health');
                log('âœ… åŸºç¡€è¿æ¥æˆåŠŸ: ' + healthResponse.status);
                
                // 2. æµ‹è¯•axiosé…ç½®
                log('2. æµ‹è¯•axiosé…ç½®...');
                const axiosInstance = axios.create({
                    baseURL: 'http://localhost:5001/api',
                    timeout: 10000,
                });
                
                // æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
                axiosInstance.interceptors.request.use(config => {
                    log('ğŸ“¤ axiosè¯·æ±‚: ' + config.method.toUpperCase() + ' ' + config.url);
                    return config;
                });
                
                // æ·»åŠ å“åº”æ‹¦æˆªå™¨
                axiosInstance.interceptors.response.use(
                    response => {
                        log('âœ… axioså“åº”æˆåŠŸ: ' + response.status);
                        return response;
                    },
                    error => {
                        log('âŒ axioså“åº”å¤±è´¥: ' + error.message);
                        if (error.response) {
                            log('é”™è¯¯çŠ¶æ€: ' + error.response.status);
                        } else if (error.request) {
                            log('ç½‘ç»œé”™è¯¯: è¯·æ±‚å·²å‘é€ä½†æ— å“åº”');
                        } else {
                            log('é…ç½®é”™è¯¯: ' + error.message);
                        }
                        return Promise.reject(error);
                    }
                );
                
                // 3. æµ‹è¯•ç™»å½•API
                log('3. æµ‹è¯•ç™»å½•API...');
                const loginResponse = await axiosInstance.post('/admin/login', {
                    email: 'admin@syntaxdropshipping.com',
                    password: 'admin123456'
                });
                
                const token = loginResponse.data.token;
                log('âœ… ç™»å½•æˆåŠŸï¼ŒToken: ' + token.substring(0, 20) + '...');
                
                // 4. æµ‹è¯•SPU API
                log('4. æµ‹è¯•SPU API...');
                axiosInstance.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                
                const spuResponse = await axiosInstance.get('/admin/spus?page=1&limit=20');
                log('âœ… SPU APIæˆåŠŸ: ' + JSON.stringify(spuResponse.data).substring(0, 100) + '...');
                
            } catch (error) {
                log('âŒ æµ‹è¯•å¤±è´¥: ' + error.message);
                console.error('è¯¦ç»†é”™è¯¯:', error);
            }
        }
        
        // å¯åŠ¨æµ‹è¯•
        testNetwork();
    </script>
</body>
</html>
